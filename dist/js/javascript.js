"use strict";!function(){function t(t){function e(){var t=$(".note-login"),e=$(".note-logined");if($.cookie("user")){var n=$.cookie("user"),o=$(".user-name");return t.hide(),o.text(n),e.show(),!0}return e.hide(),t.show(),!1}return{login:e}}function e(t,e){var n=$(".modal"),o=$(".modal-title"),a=$(".modal-body"),l=$(".modal-footer");n.attr("id",e.replace("#","")),o.empty(),a.empty(),l.empty();var s={login:{title:"登陆",body:'\n          <form>\n                <p class="tip alert alert-warning">请输入登陆信息</p>\n                <div class="form-group">\n                  <label for="user" class="control-label">账号</label>\n                  <input type="text" class="form-control loginUser" id="user">\n                </div>\n                <div class="form-group">\n                  <label for="pass" class="control-label">密码</label>\n                   <input type="password" class="form-control loginPass" id="pass">\n                </div>\n              </form>\n        ',footer:'\n          <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>\n              <button type="button" class="btn btn-primary loginConfirm">登陆</button>\n        '},register:{title:"注册",body:'\n          <form>\n                <p class="tip alert alert-warning">请输入登陆信息</p>\n                <div class="form-group">\n                  <label for="user" class="control-label">账号</label>\n                  <input type="text" class="form-control registerUser" id="user">\n                </div>\n                <div class="form-group">\n                  <label for="pass" class="control-label">密码</label>\n                  <input type="password" class="form-control registerPass1" id="pass">\n                </div>\n                <div class="form-group">\n                  <label for="confirm-pass" class="control-label">确定密码</label>\n                  <input type="password" class="form-control registerPass2" id="confirm-pass">\n                </div>\n              </form>\n        ',footer:'\n          <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>\n              <button type="button" class="btn btn-primary registerConfirm">注册</button>\n        '},add:{title:"添加",body:'\n          <form>\n            <p class="tip alert alert-warning">请输入笔记信息</p>\n            <div class="form-group">\n              <label for="title" class="control-label">标题</label>\n              <input type="text" class="form-control addTitle" id="title">\n            </div>\n            <div class="form-group">\n              <label for="content" class="control-label">内容</label>\n              <textarea  class="form-control addContent" id="content"></textarea>\n            </div>\n            <div class="form-group">\n              <label for="tag" class="control-label">标签</label>\n              <input type="text" class="form-control addTag" id="tag">\n            </div>\n          </form>\n        ',footer:'\n          <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>\n              <button type="button" class="btn btn-primary addConfirm">添加</button>\n        '}};o.append(s[t].title),a.append(s[t].body),l.append(s[t].footer)}function n(t,e,n){var o=new XMLHttpRequest;o.open(t,e,!0),o.setRequestHeader("Content-type","application/x-www-form-urlencoded"),o.onreadystatechange=function(){if(4===o.readyState&&200===o.status){console.log(o.responseText);var t=JSON.parse(o.responseText);console.log(t),"no"===t.registerState&&$(".tip").text("账号已存在"),"no"===t.loginState&&$(".tip").text("账号不存在或密码错误"),("yes"===t.registerState||"yes"===t.loginState||"login..."===t.loginState||t.logoutState||"yes"===t.deleteState||"yes"===t.addState)&&location.reload()}},o.send(n)}function o(t,e,n){var o=new XMLHttpRequest;$(".notes").append('<p class="note text-center">加载中...</p>'),o.onreadystatechange=function(){if(4===o.readyState&&200===o.status){console.log(o.responseText);var t=JSON.parse(o.responseText),e=$(".notes");if(e.empty(),console.log(t),"no"!==t.loginState)if(0!==t.length)for(var n in t){var a=t[n].id,l=t[n].title,s=t[n].content,r='\n                <div class="row note" id="'+a+'">\n                  <div class="note-title">\n                    <p class="text-center note-title-content">'+l+'</p>\n                    <div class="note-control">\n                      <span class="glyphicon glyphicon-pencil ctrl-edit"></span>\n                      <span class="glyphicon glyphicon-trash ctrl-del"></span>\n                    </div>\n                  </div>\n                  <div class="note-content">'+s+"</div>\n                </div>\n              ";e.append(r)}else e.append('<p class="note text-center">没有发现笔记哦，试着去添加一条笔记吧 ^_^</p>');else e.append('<p class="note text-center">请先登陆吧（测试账号和密码都是admin）</p>')}},o.open(t,e,!0),o.send()}function a(t){function e(){var t=$(".registerUser"),e=$(".registerPass1"),o=$(".registerPass2"),a=e.val(),l=o.val(),s=$(".tip");if(""===t.val())s.text("请输入账号");else if(""===a)s.text("请输入密码");else if(""===l)s.text("请再次输入密码");else if(a!==l)s.text("两次输入的密码不一致");else{var r={user:t.val(),pass:a},i="";for(var c in r)i+=c+"="+r[c]+"&";console.log(i),n("POST","./api/user/register.php","user="+r.user+"&pass="+r.pass+"&mail=")}}function o(){var t=$(".loginUser"),e=$(".loginPass"),o=$(".tip"),a={user:t.val(),pass:e.val()};""===t.val()?o.text("请输入账号"):""===e.val()?o.text("请输入密码"):(console.log("user:"+a.user),console.log("pass:"+a.pass),n("POST","./api/user/login.php","user="+a.user+"&pass="+a.pass))}function a(){var e=t.find(".note-title-content"),o=t.find(".note-content");e.attr("contenteditable","true"),e.focus(),o.attr("contenteditable","true"),console.log("title"),console.log("content"),t.mouseleave(function(a){$("body").click(function(){e.attr("contenteditable","false"),o.attr("contenteditable","false");var a=e.text(),l=o.text();console.log(a),console.log(l),n("POST","./api/note/modify.php","noteId="+i+"&title="+a+"&content="+l),t.unbind(""),$("body").unbind("")})})}function l(){var t=$(".addTitle"),e=$(".addContent"),o=$(".addTag"),a=new Date,l=(a.getTime(),$(".tip")),s={title:t.val(),content:e.val(),tag:o.val(),date:"2017-03-11"};""===s.title?l.text("请输入标题"):""===s.content?l.text("请输入内容"):n("POST","./api/note/add.php","title="+s.title+"&content="+s.content+"&tag="+s.tag+"&date="+s.date)}function s(){n("POST","./api/note/delete.php","noteId="+i)}function r(){n("POST","./api/user/logout.php")}if(void 0!==t){var t=t.parent().parent().parent(),i=t.attr("id");console.log(t),console.log(i)}return{register:e,login:o,add:l,edit:a,del:s,logout:r}}!function(){var n=t().login(),l=$(".notes");if(n){o("GET","./api/note/search.php");var s=($(".ctrl-edit"),$(".ctrl-del"),$(".ctrl-add")),r=s.attr("id"),i=s.attr("data-target"),c=$(".logout");s.click(function(){return e(r,i)}),$(document).on("click",".addConfirm",function(){return a().add()}),c.click(function(){return a().logout()}),$(document).on("click",".ctrl-edit",function(){a($(this)).edit()}),$(document).on("click",".ctrl-del",function(){a($(this)).del()})}else{l.html('<p class="row note text-center">请先登陆吧（测试账号和密码都是admin）</p>');var d=$("#login"),p=d.attr("id"),u=d.attr("data-target").replace("#",""),f=$("#register"),g=f.attr("id"),b=f.attr("data-target").replace("#","");d.click(function(){e(p,u)}),$(document).on("click",".loginConfirm",function(){a().login(),window.event.cancelBubble=!0}),f.click(function(){return e(g,b)}),$(document).on("click",".registerConfirm",function(){return a().register()})}}()}();