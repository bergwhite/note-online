"use strict";!function(){function t(t){function n(){var t=$(".note-login"),n=$(".note-logined");if($.cookie("user")){var e=$.cookie("user"),o=$(".user-name");return t.hide(),o.text(e),n.show(),!0}return n.hide(),t.show(),!1}return{login:n}}function n(t,n){var e=$(".modal"),o=$(".modal-title"),a=$(".modal-body"),l=$(".modal-footer");e.attr("id",n.replace("#","")),o.empty(),a.empty(),l.empty();var s={login:{title:"登陆",body:'\n          <form>\n                <div class="form-group">\n                  <label for="user" class="control-label">账号</label>\n                  <input type="text" class="form-control loginUser" id="user">\n                </div>\n                <div class="form-group">\n                  <label for="pass" class="control-label">密码</label>\n                   <input type="password" class="form-control loginPass" id="pass">\n                </div>\n              </form>\n        ',footer:'\n          <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>\n              <button type="button" class="btn btn-primary loginConfirm">登陆</button>\n        '},register:{title:"注册",body:'\n          <form>\n                <div class="form-group">\n                  <label for="user" class="control-label">账号</label>\n                  <input type="text" class="form-control registerUser" id="user">\n                </div>\n                <div class="form-group">\n                  <label for="pass" class="control-label">密码</label>\n                  <input type="password" class="form-control registerPass1" id="pass">\n                </div>\n                <div class="form-group">\n                  <label for="confirm-pass" class="control-label">确定密码</label>\n                  <input type="password" class="form-control registerPass2" id="confirm-pass">\n                </div>\n              </form>\n        ',footer:'\n          <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>\n              <button type="button" class="btn btn-primary registerConfirm">注册</button>\n        '},add:{title:"添加",body:'\n          <form>\n            <div class="form-group">\n              <label for="title" class="control-label">标题</label>\n              <input type="text" class="form-control addTitle" id="title">\n            </div>\n            <div class="form-group">\n              <label for="content" class="control-label">内容</label>\n              <textarea  class="form-control addContent" id="content"></textarea>\n            </div>\n            <div class="form-group">\n              <label for="tag" class="control-label">标签</label>\n              <input type="text" class="form-control addTag" id="tag">\n            </div>\n          </form>\n        ',footer:'\n          <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>\n              <button type="button" class="btn btn-primary addConfirm">添加</button>\n        '}};o.append(s[t].title),a.append(s[t].body),l.append(s[t].footer)}function e(t,n,e){var o=new XMLHttpRequest;o.open(t,n,!0),o.setRequestHeader("Content-type","application/x-www-form-urlencoded"),o.onreadystatechange=function(){if(4===o.readyState&&200===o.status){console.log(o.responseText);var t=JSON.parse(o.responseText);console.log(t),("yes"===t.registerState||"yes"===t.loginState||"login..."===t.loginState||t.logoutState||"yes"===t.deleteState||"yes"===t.addState)&&location.reload()}},o.send(e)}function o(t,n,e){var o=new XMLHttpRequest;$(".notes").append('<p class="note text-center">加载中...</p>'),o.onreadystatechange=function(){if(4===o.readyState&&200===o.status){console.log(o.responseText);var t=JSON.parse(o.responseText),n=$(".notes");if(n.empty(),console.log(t),"no"!==t.loginState)if(0!==t.length)for(var e in t){var a=t[e].id,l=t[e].title,s=t[e].content,r='\n                <div class="row note" id="'+a+'">\n                  <div class="note-title">\n                    <p class="text-center note-title-content">'+l+'</p>\n                    <div class="note-control">\n                      <span class="glyphicon glyphicon-pencil ctrl-edit"></span>\n                      <span class="glyphicon glyphicon-trash ctrl-del"></span>\n                    </div>\n                  </div>\n                  <div class="note-content">'+s+"</div>\n                </div>\n              ";n.append(r)}else n.append('<p class="note text-center">没有发现笔记哦，试着去添加一条笔记吧 ^_^</p>');else n.append('<p class="note text-center">请先登陆吧（测试账号和密码都是admin）</p>')}},o.open(t,n,!0),o.send()}function a(t){function n(){var t=$(".registerUser"),n=$(".registerPass1"),o=$(".registerPass2");if(n.val()===o.val()){var a={user:t.val(),pass:n.val()},l="";for(var s in a)l+=s+"="+a[s]+"&";console.log(l),e("POST","./api/user/register.php","user="+a.user+"&pass="+a.pass+"&mail=")}else o.addClass("alert alert-warning")}function o(){var t=$(".loginUser"),n=$(".loginPass"),o={user:t.val(),pass:n.val()};console.log("user:"+o.user),console.log("pass:"+o.pass),e("POST","./api/user/login.php","user="+o.user+"&pass="+o.pass)}function a(){var n=t.find(".note-title-content"),o=t.find(".note-content");n.attr("contenteditable","true"),n.focus(),o.attr("contenteditable","true"),console.log("title"),console.log("content"),t.mouseleave(function(a){$("body").click(function(){n.attr("contenteditable","false"),o.attr("contenteditable","false");var a=n.text(),l=o.text();console.log(a),console.log(l),e("POST","./api/note/modify.php","noteId="+i+"&title="+a+"&content="+l),t.unbind(""),$("body").unbind("")})})}function l(){var t=$(".addTitle"),n=$(".addContent"),o=$(".addTag"),a=new Date,l=(a.getTime(),{title:t.val(),content:n.val(),tag:o.val(),date:"2017-03-11"});e("POST","./api/note/add.php","title="+l.title+"&content="+l.content+"&tag="+l.tag+"&date="+l.date)}function s(){e("POST","./api/note/delete.php","noteId="+i)}function r(){e("POST","./api/user/logout.php")}if(void 0!==t){var t=t.parent().parent().parent(),i=t.attr("id");console.log(t),console.log(i)}return{register:n,login:o,add:l,edit:a,del:s,logout:r}}!function(){var e=t().login(),l=$(".notes");if(e){o("GET","./api/note/search.php");var s=($(".ctrl-edit"),$(".ctrl-del"),$(".ctrl-add")),r=s.attr("id"),i=s.attr("data-target"),c=$(".logout");s.click(function(){return n(r,i)}),$(document).on("click",".addConfirm",function(){return a().add()}),c.click(function(){return a().logout()}),$(document).on("click",".ctrl-edit",function(){a($(this)).edit()}),$(document).on("click",".ctrl-del",function(){a($(this)).del()})}else{l.html('<p class="row note text-center">请先登陆吧（测试账号和密码都是admin）</p>');var d=$("#login"),p=d.attr("id"),u=d.attr("data-target").replace("#",""),f=$("#register"),g=f.attr("id"),b=f.attr("data-target").replace("#","");d.click(function(){n(p,u)}),$(document).on("click",".loginConfirm",function(){a().login(),window.event.cancelBubble=!0}),f.click(function(){return n(g,b)}),$(document).on("click",".registerConfirm",function(){return a().register()})}}()}();